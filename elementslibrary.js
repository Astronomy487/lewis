let e = [];
e[1]={abbr:"H",name:"hydrogen",type:"nonmetal",period:1,group:1,mass:1.00794,melting:13.81,boiling:20.28,discovered:1776,color:"#FFFFFF"};
e[2]={abbr:"He",name:"helium",type:"noble",period:1,group:18,mass:4.0026,melting:0.95,boiling:4.216,discovered:1895,color:"#D9FFFF"};
e[3]={abbr:"Li",name:"lithium",type:"alkali",period:2,group:1,mass:6.941,melting:453.7,boiling:1615,discovered:1817,color:"#CC80FF"};
e[4]={abbr:"Be",name:"beryllium",type:"alkaline",period:2,group:2,mass:9.01218,melting:1560,boiling:3243,discovered:1797,color:"#C2FF00"};
e[5]={abbr:"B",name:"boron",type:"metalloid",period:2,group:13,mass:10.811,melting:2365,boiling:4275,discovered:1808,color:"#FFB5B5"};
e[6]={abbr:"C",name:"carbon",type:"nonmetal",period:2,group:14,mass:12.011,melting:3825,boiling:5100,discovered:0,color:"#909090"};
e[7]={abbr:"N",name:"nitrogen",type:"nonmetal",period:2,group:15,mass:14.0067,melting:63.15,boiling:77.344,discovered:1772,color:"#3050F8"};
e[8]={abbr:"O",name:"oxygen",type:"nonmetal",period:2,group:16,mass:15.9994,melting:54.8,boiling:90.188,discovered:1774,color:"#FF0D0D"};
e[9]={abbr:"F",name:"fluorine",type:"halogen",period:2,group:17,mass:18.9984,melting:53.55,boiling:85,discovered:1886,color:"#90E050"};
e[10]={abbr:"Ne",name:"neon",type:"noble",period:2,group:18,mass:20.1797,melting:24.55,boiling:27.1,discovered:1898,color:"#B3E3F5"};
e[11]={abbr:"Na",name:"sodium",type:"alkali",period:3,group:1,mass:22.98977,melting:371,boiling:1156,discovered:1807,color:"#AB5CF2"};
e[12]={abbr:"Mg",name:"magnesium",type:"alkaline",period:3,group:2,mass:24.305,melting:922,boiling:1380,discovered:1755,color:"#8AFF00"};
e[13]={abbr:"Al",name:"aluminum",type:"posttransition",period:3,group:13,mass:26.98154,melting:933.5,boiling:2740,discovered:1825,color:"#BFA6A6"};
e[14]={abbr:"Si",name:"silicon",type:"metalloid",period:3,group:14,mass:28.0855,melting:1683,boiling:2630,discovered:1824,color:"#F0C8A0"};
e[15]={abbr:"P",name:"phosphorus",type:"nonmetal",period:3,group:15,mass:30.97376,melting:317.3,boiling:553,discovered:1669,color:"#FF8000"};
e[16]={abbr:"S",name:"sulfur",type:"nonmetal",period:3,group:16,mass:32.066,melting:392.2,boiling:717.82,discovered:0,color:"#FFFF30"};
e[17]={abbr:"Cl",name:"chlorine",type:"halogen",period:3,group:17,mass:35.4527,melting:172.17,boiling:239.18,discovered:1774,color:"#1FF01F"};
e[18]={abbr:"Ar",name:"argon",type:"noble",period:3,group:18,mass:39.948,melting:83.95,boiling:87.45,discovered:1894,color:"#80D1E3"};
e[19]={abbr:"K",name:"potassium",type:"alkali",period:4,group:1,mass:39.0983,melting:336.8,boiling:1033,discovered:1807,color:"#8F40D4"};
e[20]={abbr:"Ca",name:"calcium",type:"alkaline",period:4,group:2,mass:40.078,melting:1112,boiling:1757,discovered:1879,color:"#3DFF00"};
e[21]={abbr:"Sc",name:"scandium",type:"transition",period:4,group:3,mass:44.9559,melting:1814,boiling:3109,discovered:1791,color:"#E6E6E6"};
e[22]={abbr:"Ti",name:"titanium",type:"transition",period:4,group:4,mass:47.88,melting:1945,boiling:3560,discovered:1830,color:"#BFC2C7"};
e[23]={abbr:"V",name:"vanadium",type:"transition",period:4,group:5,mass:50.9415,melting:2163,boiling:3650,discovered:1797,color:"#A6A6AB"};
e[24]={abbr:"Cr",name:"chromium",type:"transition",period:4,group:6,mass:51.996,melting:2130,boiling:2945,discovered:1774,color:"#8A99C7"};
e[25]={abbr:"Mn",name:"manganese",type:"transition",period:4,group:7,mass:54.938,melting:1518,boiling:2335,discovered:1774,color:"#9C7AC7"};
e[26]={abbr:"Fe",name:"iron",type:"transition",period:4,group:8,mass:55.847,melting:1808,boiling:3023,discovered:0,color:"#E06633"};
e[27]={abbr:"Co",name:"cobalt",type:"transition",period:4,group:9,mass:58.9332,melting:1768,boiling:3143,discovered:1751,color:"#F090A0"};
e[28]={abbr:"Ni",name:"nickel",type:"transition",period:4,group:10,mass:58.6934,melting:1726,boiling:3005,discovered:1751,color:"#50D050"};
e[29]={abbr:"Cu",name:"copper",type:"transition",period:4,group:11,mass:63.546,melting:1356.6,boiling:2840,discovered:0,color:"#C88033"};
e[30]={abbr:"Zn",name:"zinc",type:"posttransition",period:4,group:12,mass:65.39,melting:692.73,boiling:1180,discovered:0,color:"#7D80B0"};
e[31]={abbr:"Ga",name:"gallium",type:"posttransition",period:4,group:13,mass:69.723,melting:302.92,boiling:2478,discovered:1886,color:"#C28F8F"};
e[32]={abbr:"Ge",name:"germanium",type:"metalloid",period:4,group:14,mass:72.61,melting:1211.5,boiling:3107,discovered:1886,color:"#668F8F"};
e[33]={abbr:"As",name:"arsenic",type:"metalloid",period:4,group:15,mass:74.9216,melting:1090,boiling:876,discovered:0,color:"#BD80E3"};
e[34]={abbr:"Se",name:"selenium",type:"nonmetal",period:4,group:16,mass:78.96,melting:494,boiling:958,discovered:1826,color:"#FFA100"};
e[35]={abbr:"Br",name:"bromine",type:"halogen",period:4,group:17,mass:79.904,melting:265.95,boiling:331.85,discovered:1826,color:"#A62929"};
e[36]={abbr:"Kr",name:"krypton",type:"noble",period:4,group:18,mass:83.8,melting:116,boiling:120.85,discovered:1898,color:"#5CB8D1"};
e[37]={abbr:"Rb",name:"rubidium",type:"alkali",period:5,group:1,mass:85.4678,melting:312.63,boiling:961,discovered:1861,color:"#702EB0"};
e[38]={abbr:"Sr",name:"strontium",type:"alkaline",period:5,group:2,mass:87.62,melting:1042,boiling:1655,discovered:1790,color:"#00FF00"};
e[39]={abbr:"Y",name:"yttrium",type:"transition",period:5,group:3,mass:88.9059,melting:1795,boiling:3611,discovered:1794,color:"#94FFFF"};
e[40]={abbr:"Zr",name:"zirconium",type:"transition",period:5,group:4,mass:91.224,melting:2128,boiling:4682,discovered:1789,color:"#94E0E0"};
e[41]={abbr:"Nb",name:"niobium",type:"transition",period:5,group:5,mass:92.9064,melting:2742,boiling:5015,discovered:1801,color:"#73C2C9"};
e[42]={abbr:"Mo",name:"molybdenum",type:"transition",period:5,group:6,mass:95.94,melting:2896,boiling:4912,discovered:1781,color:"#54B5B5"};
e[43]={abbr:"Tc",name:"technetium",type:"transition",period:5,group:7,mass:98,melting:2477,boiling:4538,discovered:1937,color:"#3B9E9E"};
e[44]={abbr:"Ru",name:"ruthenium",type:"transition",period:5,group:8,mass:101.07,melting:2610,boiling:4425,discovered:1844,color:"#248F8F"};
e[45]={abbr:"Rh",name:"rhodium",type:"transition",period:5,group:9,mass:102.9055,melting:2236,boiling:3970,discovered:1803,color:"#0A7D8C"};
e[46]={abbr:"Pd",name:"palladium",type:"transition",period:5,group:10,mass:106.42,melting:1825,boiling:3240,discovered:1803,color:"#006985"};
e[47]={abbr:"Ag",name:"silver",type:"transition",period:5,group:11,mass:107.868,melting:1235.08,boiling:2436,discovered:0,color:"#C0C0C0"};
e[48]={abbr:"Cd",name:"cadmium",type:"posttransition",period:5,group:12,mass:112.41,melting:594.26,boiling:1040,discovered:1817,color:"#FFD98F"};
e[49]={abbr:"In",name:"indium",type:"posttransition",period:5,group:13,mass:114.82,melting:429.78,boiling:2350,discovered:1863,color:"#A67573"};
e[50]={abbr:"Sn",name:"tin",type:"posttransition",period:5,group:14,mass:118.71,melting:505.12,boiling:2876,discovered:0,color:"#668080"};
e[51]={abbr:"Sb",name:"antimony",type:"metalloid",period:5,group:15,mass:121.757,melting:903.91,boiling:1860,discovered:0,color:"#9E63B5"};
e[52]={abbr:"Te",name:"tellurium",type:"metalloid",period:5,group:16,mass:127.6,melting:722.72,boiling:1261,discovered:1782,color:"#D47A00"};
e[53]={abbr:"I",name:"iodine",type:"halogen",period:5,group:17,mass:126.9045,melting:386.7,boiling:457.5,discovered:1811,color:"#940094"};
e[54]={abbr:"Xe",name:"xenon",type:"noble",period:5,group:18,mass:131.29,melting:161.39,boiling:165.1,discovered:1898,color:"#429EB0"};
e[55]={abbr:"Cs",name:"caesium",type:"alkali",period:6,group:1,mass:132.9054,melting:301.54,boiling:944,discovered:1860,color:"#57178F"};
e[56]={abbr:"Ba",name:"barium",type:"alkaline",period:6,group:2,mass:137.33,melting:1002,boiling:2078,discovered:1808,color:"#00C900"};
e[57]={abbr:"La",name:"lanthanum",type:"lanthanide",period:6,group:3,mass:138.9055,melting:1191,boiling:3737,discovered:1839,color:"#70D4FF"};
e[58]={abbr:"Ce",name:"cerium",type:"lanthanide",period:6,group:3,mass:140.12,melting:1071,boiling:3715,discovered:1803,color:"#FFFFC7"};
e[59]={abbr:"Pr",name:"praseodymium",type:"lanthanide",period:6,group:3,mass:140.9077,melting:1204,boiling:3785,discovered:1885,color:"#D9FFC7"};
e[60]={abbr:"Nd",name:"neodymium",type:"lanthanide",period:6,group:3,mass:144.24,melting:1294,boiling:3347,discovered:1885,color:"#C7FFC7"};
e[61]={abbr:"Pm",name:"promethium",type:"lanthanide",period:6,group:3,mass:145,melting:1315,boiling:3273,discovered:1945,color:"#A3FFC7"};
e[62]={abbr:"Sm",name:"samarium",type:"lanthanide",period:6,group:3,mass:150.36,melting:1347,boiling:2067,discovered:1879,color:"#8FFFC7"};
e[63]={abbr:"Eu",name:"europium",type:"lanthanide",period:6,group:3,mass:151.965,melting:1095,boiling:1800,discovered:1901,color:"#61FFC7"};
e[64]={abbr:"Gd",name:"gadolinium",type:"lanthanide",period:6,group:3,mass:157.25,melting:1585,boiling:3545,discovered:1880,color:"#45FFC7"};
e[65]={abbr:"Tb",name:"terbium",type:"lanthanide",period:6,group:3,mass:158.9253,melting:1629,boiling:3500,discovered:1843,color:"#30FFC7"};
e[66]={abbr:"Dy",name:"dysprosium",type:"lanthanide",period:6,group:3,mass:162.5,melting:1685,boiling:2840,discovered:1886,color:"#1FFFC7"};
e[67]={abbr:"Ho",name:"holmiun",type:"lanthanide",period:6,group:3,mass:164.9303,melting:1747,boiling:2968,discovered:1867,color:"#00FF9C"};
e[68]={abbr:"Er",name:"erbium",type:"lanthanide",period:6,group:3,mass:167.26,melting:1802,boiling:3140,discovered:1842,color:"#00E675"};
e[69]={abbr:"Tm",name:"thulium",type:"lanthanide",period:6,group:3,mass:168.9342,melting:1818,boiling:2223,discovered:1879,color:"#00D452"};
e[70]={abbr:"Yb",name:"ytterbium",type:"lanthanide",period:6,group:3,mass:173.04,melting:1092,boiling:1469,discovered:1878,color:"#00BF38"};
e[71]={abbr:"Lu",name:"lutetium",type:"lanthanide",period:6,group:3,mass:174.967,melting:1936,boiling:3668,discovered:1907,color:"#00AB24"};
e[72]={abbr:"Hf",name:"hafnium",type:"transition",period:6,group:4,mass:178.49,melting:2504,boiling:4875,discovered:1923,color:"#4DC2FF"};
e[73]={abbr:"Ta",name:"tantalum",type:"transition",period:6,group:5,mass:180.9479,melting:3293,boiling:5730,discovered:1802,color:"#4DA6FF"};
e[74]={abbr:"W",name:"tungsten",type:"transition",period:6,group:6,mass:183.85,melting:3695,boiling:5825,discovered:1783,color:"#2194D6"};
e[75]={abbr:"Re",name:"rhenium",type:"transition",period:6,group:7,mass:186.207,melting:3455,boiling:5870,discovered:1925,color:"#267DAB"};
e[76]={abbr:"Os",name:"osmium",type:"transition",period:6,group:8,mass:190.2,melting:3300,boiling:5300,discovered:1803,color:"#266696"};
e[77]={abbr:"Ir",name:"iridium",type:"transition",period:6,group:9,mass:192.22,melting:2720,boiling:4700,discovered:1803,color:"#175487"};
e[78]={abbr:"Pt",name:"platinum",type:"transition",period:6,group:10,mass:195.08,melting:2042.1,boiling:4100,discovered:1735,color:"#D0D0E0"};
e[79]={abbr:"Au",name:"gold",type:"transition",period:6,group:11,mass:196.9665,melting:1337.58,boiling:3130,discovered:0,color:"#FFD123"};
e[80]={abbr:"Hg",name:"mercury",type:"posttransition",period:6,group:12,mass:200.59,melting:234.31,boiling:629.88,discovered:0,color:"#B8B8D0"};
e[81]={abbr:"Tl",name:"thallium",type:"posttransition",period:6,group:13,mass:204.383,melting:577,boiling:1746,discovered:1861,color:"#A6544D"};
e[82]={abbr:"Pb",name:"lead",type:"posttransition",period:6,group:14,mass:207.2,melting:600.65,boiling:2023,discovered:0,color:"#575961"};
e[83]={abbr:"Bi",name:"bismuth",type:"posttransition",period:6,group:15,mass:208.9804,melting:544.59,boiling:1837,discovered:0,color:"#9E4FB5"};
e[84]={abbr:"Po",name:"polonium",type:"posttransition",period:6,group:16,mass:null,melting:null,boiling:null,discovered:1898,color:"#AB5C00"};
e[85]={abbr:"At",name:"astatine",type:"halogen",period:6,group:17,mass:210,melting:575,boiling:610,discovered:1940,color:"#754F45"};
e[86]={abbr:"Rn",name:"radon",type:"noble",period:6,group:18,mass:222,melting:202,boiling:211.4,discovered:1900,color:"#428296"};
e[87]={abbr:"Fr",name:"francium",type:"alkali",period:7,group:1,mass:223,melting:300,boiling:950,discovered:1939,color:"#420066"};
e[88]={abbr:"Ra",name:"radium",type:"alkaline",period:7,group:2,mass:226.0254,melting:973,boiling:1413,discovered:1898,color:"#007D00"};
e[89]={abbr:"Ac",name:"actinium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1899,color:"#70ABFA"};
e[90]={abbr:"Th",name:"thorium",type:"actinide",period:7,group:3,mass:232.0381,melting:2028,boiling:5060,discovered:1829,color:"#00BAFF"};
e[91]={abbr:"Pa",name:"protactinium",type:"actinide",period:7,group:3,mass:231.0359,melting:1845,boiling:4300,discovered:1913,color:"#00A1FF"};
e[92]={abbr:"U",name:"uranium",type:"actinide",period:7,group:3,mass:238.029,melting:1408,boiling:4407,discovered:1789,color:"#008FFF"};
e[93]={abbr:"Np",name:"neptunium",type:"actinide",period:7,group:3,mass:237.0482,melting:912,boiling:4175,discovered:1940,color:"#0080FF"};
e[94]={abbr:"Pu",name:"plutonium",type:"actinide",period:7,group:3,mass:244,melting:913,boiling:3505,discovered:1940,color:"#006BFF"};
e[95]={abbr:"Am",name:"americium",type:"actinide",period:7,group:3,mass:243,melting:1449,boiling:2880,discovered:1944,color:"#545CF2"};
e[96]={abbr:"Cm",name:"curium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1944,color:"#785CE3"};
e[97]={abbr:"Bk",name:"berkelium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1949,color:"#8A4FE3"};
e[98]={abbr:"Cf",name:"californium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1950,color:"#A136D4"};
e[99]={abbr:"Es",name:"einsteinium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1952,color:"#B31FD4"};
e[100]={abbr:"Fm",name:"fermium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1952,color:"#B31FBA"};
e[101]={abbr:"Md",name:"mendelevium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1955,color:"#B30DA6"};
e[102]={abbr:"No",name:"nobelium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1958,color:"#BD0D87"};
e[103]={abbr:"Lr",name:"lawrencium",type:"actinide",period:7,group:3,mass:null,melting:null,boiling:null,discovered:1961,color:"#C70066"};
e[104]={abbr:"Rf",name:"rutherfordium",type:"transition",period:7,group:4,mass:null,melting:null,boiling:null,discovered:1964,color:"#CC0059"};
e[105]={abbr:"Db",name:"dubnium",type:"transition",period:7,group:5,mass:null,melting:null,boiling:null,discovered:1967,color:"#D1004F"};
e[106]={abbr:"Sg",name:"seaborgium",type:"transition",period:7,group:6,mass:null,melting:null,boiling:null,discovered:1974,color:"#D90045"};
e[107]={abbr:"Bh",name:"bohrium",type:"transition",period:7,group:7,mass:null,melting:null,boiling:null,discovered:1981,color:"#E00038"};
e[108]={abbr:"Hs",name:"hassium",type:"transition",period:7,group:8,mass:null,melting:null,boiling:null,discovered:1984,color:"#E6002E"};
e[109]={abbr:"Mt",name:"meitnerium",type:"unknown",period:7,group:9,mass:null,melting:null,boiling:null,discovered:1982,color:"#EB0026"};
e[110]={abbr:"Ds",name:"darmstadtium",type:"unknown",period:7,group:10,mass:null,melting:null,boiling:null,discovered:1994,color:""};
e[111]={abbr:"Rg",name:"roentgenium",type:"unknown",period:7,group:11,mass:null,melting:null,boiling:null,discovered:1994,color:""};
e[112]={abbr:"Cn",name:"copernicium",type:"posttransition",period:7,group:12,mass:null,melting:null,boiling:null,discovered:1996,color:""};
e[113]={abbr:"Nh",name:"nihonium",type:"unknown",period:7,group:13,mass:null,melting:null,boiling:null,discovered:2003,color:""};
e[114]={abbr:"Fl",name:"flerovium",type:"unknown",period:7,group:14,mass:null,melting:null,boiling:null,discovered:1998,color:""};
e[115]={abbr:"Mc",name:"moscovium",type:"unknown",period:7,group:15,mass:null,melting:null,boiling:null,discovered:2003,color:""};
e[116]={abbr:"Lv",name:"livermorium",type:"unknown",period:7,group:16,mass:null,melting:null,boiling:null,discovered:2000,color:""};
e[117]={abbr:"Ts",name:"tennessine",type:"unknown",period:7,group:17,mass:null,melting:null,boiling:null,discovered:2010,color:""};
e[118]={abbr:"Og",name:"oganesson",type:"unknown",period:7,group:18,mass:null,melting:null,boiling:null,discovered:2002,color:""};

for (let i = 1; i <= 118; i++) {
	e[i].z = i;
}

function element_to_molar_mass(symbol) {
	for (let element of e) if (element) if (element.abbr == symbol) return element.mass ? element.mass : 1;
	return 1;
}

let uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
let lowercase = "abcdefghijklmnopqrstuvwxyz";
let numerals = "0123456789";

function symbol_to_molar_mass(symbol) {
	let total = 0;
	let atom_counts = symbol_to_atom_counts(symbol);
	if (!atom_counts) return 0;
	for (let element of Object.keys(atom_counts)) {
		total += element_to_molar_mass(element) * atom_counts[element];
	}
	return total;
}

function symbol_to_atom_counts(symbol) {
	//return null = bad vibes. erroneous
	symbol += " "; //dumbest thing :3
	//ok break it up into tokens, which are introduced
	// Capital letter              Stops when lowercase stops
	// Number											 Stops when numbers stop. will modify previous token 
	// ()													 Find closing parentheses
	let tokens = [];
	for (let i = 0; i < symbol.length; i++) {
		let character = symbol.charAt(i);
		if (uppercase.includes(character)) {
			//start new token that is just an element
			let this_token = character;
			i++;
			while (lowercase.includes(symbol.charAt(i))) {
				this_token += symbol.charAt(i);
				i++;
			}
			tokens.push({text: this_token, type: "element"});
			i--;
		} else if (numerals.includes(character)) {
			//start new token that is just a number
			if (!tokens.length) return null;
			let this_token = character;
			i++;
			while (numerals.includes(symbol.charAt(i))) {
				this_token += symbol.charAt(i);
				i++;
			}
			tokens.push({text: this_token, type: "number"});
			i--;
		} else if (character == "(" || character == "[") {
			//start new token that is parentheses.
			let this_token = character;
			let parentheses_count = 1;
			i++;
			while (parentheses_count && i < symbol.length) {
				character = symbol.charAt(i);
				this_token += character;
				if (character == "(" || character == "[") parentheses_count++;
				if (character == ")" || character == "]") parentheses_count--;
				i++;
			}
			if (parentheses_count) return null;
			tokens.push({text: this_token.substring(1, this_token.length-1), type: "parentheses"});
			i--;
		}
	}
	//make running total for the element counts. eg {H: 2, O: 1}
	let element_counts = {};
	function add_counts(other_object, multiplier = 1) { //other_object is another element counts object
		for (let el of Object.keys(other_object)) {
			if (!element_counts[el]) element_counts[el] = 0;
			element_counts[el] += other_object[el] * multiplier;
		}
	}
	//now we have our tokens. lets evaluate
	for (let token of tokens) {
		//each token will become an object count element
		if (token.type == "element") {
			token.count = {};
			token.count[token.text] = 1;
		}
		if (token.type == "parentheses") {
			token.count = symbol_to_atom_counts(token.text);
			if (!token.count) return null;
		}
	}
	//every token has its element counter. apply multipliers and assemble to element_counts
	if (tokens[0].type == "number") return null;
	for (let i = 0; i < tokens.length; i++) {
		let multiplier = 1;
		if (i+1 < tokens.length && tokens[i+1].type == "number") multiplier = parseInt(tokens[i+1].text);
		if (tokens[i].type == "element" || tokens[i].type == "parentheses") add_counts(tokens[i].count, multiplier);
	}
	return element_counts;
}

function parse_equation(text) {
	text = text.trim().replaceAll("-->", "=").replaceAll("->", "=").replaceAll("==>", "=").replaceAll("=>", "=").replaceAll("→", "=");
	let [before, after] = text.split("=");
	if (!before || !after) return;
	let sides = [];
	for (let segment of [before.trim(), after.trim()]) {
		//split segment by +
		let components = segment.split("+"); //components is a list of things like 2H2 , O2 , H2O
		if (!components.length) return;
		for (let i = 0; i < components.length; i++) {
			let token = components[i].trim();
			if (!token.length) return;
			//if something starts with a number, thats a multiplier !
			let j = 0;
			while (numerals.includes(token.charAt(j))) {
				j++;
			}
			components[i] = {
				count: j ? parseInt(token.substring(0, j)) : 1,
				text: j ? token.substring(j).trim() : token
			};
		}
		sides.push(components);
		//each member of before and after look like {text, count}
	}
	//look for duplicate chemicals (just by string comparison. no fancy checks for (H2)O and H2O or anything stupid)
	for (let i = 0; i < sides[0].length; i++) for (let j = 0; j < sides[1].length; j++) {
		if (sides[0][i].text == sides[1][j].text) {
			let amount_to_remove = Math.min(sides[0][i].count, sides[1][j].count);
			sides[0][i].count -= amount_to_remove;
			sides[1][j].count -= amount_to_remove;
		}
	}
	sides[0] = sides[0].filter((a) => a.count);
	sides[1] = sides[1].filter((a) => a.count);
	let referenced_substances = [];
	for (let side of sides) for (let token of side) if (!referenced_substances.includes(token.text)) referenced_substances.push(token.text);
	return [sides[0], sides[1], referenced_substances];
}

let avogadro_number = 6.02214076e-23;

function make_number_pretty(x) { //returns html !
	x = x.toPrecision(5);
	if (x.includes("e+")) {
		x = x.replace("e+", " × 10<sup>") + "</sup>";
	} else if (x.includes("e-")) {
		x = x.replace("e-", " × 10<sup>-") + "</sup>";
	} else {
		while (x.endsWith("0")) x = x.substring(0, x.length-1);
		while (x.endsWith(".")) x = x.substring(0, x.length-1);
	}
	return x;
}

function make_formula_pretty(text) {
	//do NOT include coefficients! they will become tiny!
	for (let digit = 0; digit <= 9; digit++) text = text.replaceAll(digit, "<sub>"+digit+"</sub>");
	return text.replaceAll("</sub><sub>", "");
}

function symbol_to_element_object(symbol) {
	for (let element of e) if (element) if (element.abbr == symbol) return element;
	return null;
}